{% extends "layout.html" %}
{% load static %}

{% block title %} 
    {{ config.display_name }} - Tester
{% endblock title %}

{% block content %}
<script>
    document.addEventListener('DOMContentLoaded', function(){
        {% for field in config.input_fields %}
        {% if field.type == 'number' %}
        const slider_{{ field.name }} = document.getElementById('{{ field.name }}');
        const display_{{ field.name }} = document.getElementById('{{ field.name }}Value');
        
        if (slider_{{ field.name }} && display_{{ field.name }}) {
            display_{{ field.name }}.textContent = slider_{{ field.name }}.value;
            slider_{{ field.name }}.addEventListener('input', function() {
                display_{{ field.name }}.textContent = this.value;
            });
        }
        {% endif %}
        {% endfor %}
    });
</script>

<div class="container">
    <h2 class="mb-4">{{ config.display_name }} - Formulaire de Prédiction</h2>
    
    <div class="card">
        <div class="card-body">
            <form method="post" action="{% url 'model_prediction' config.name %}" class="p-4">
                {% csrf_token %}
                
                {% for field in config.input_fields %}
                <div class="mb-4" style="overflow-y: auto;">
                    <label for="{{ field.name }}" class="form-label">{{ field.label }}</label>
                    
                    {% if field.type == 'range' %}
                    <input type="range" 
                           class="form-range" 
                           id="{{ field.name }}" 
                           name="{{ field.name }}"
                           min="{{ field.min }}" 
                           max="{{ field.max }}" 
                           step="{{ field.step }}" 
                           value="{{ field.default }}">
                    <span class="slider-value" id="{{ field.name }}_value">{{ field.default }}</span>
                    
                    {% elif field.type == 'number' %}
                        <div class="mb-4">
                            <input type="range" 
                                class="form-range" 
                                min="{{ field.min }}" 
                                max="{{ field.max }}" 
                                step="{{ field.step }}" 
                                id="{{ field.name }}" 
                                name="{{ field.name }}"
                                value="{{ field.default }}" 
                                oninput="document.getElementById('{{ field.name }}Value').textContent=this.value">
                            <span  id="{{ field.name }}Value">{{ field.default }}</span>
                        </div>
                
                    
                    {% elif field.type == 'text' %}
                    <input type="text" 
                           class="form-control" 
                           id="{{ field.name }}" 
                           name="{{ field.name }}"
                           value="{{ field.default }}">
                           
                    {% elif field.type == 'select' %}
                    <!-- Select Dropdown -->
                    <select class="form-select" 
                            id="{{ field.name }}" 
                            name="{{ field.name }}">
                        {% for option in field.options %}
                        <option value="{{ option.value }}" 
                                {% if option.value == field.default %}selected{% endif %}>
                            {{ option.label }}
                        </option>
                        {% endfor %}
                    </select>

                    {% elif field.type == 'radio' %}
                        <!-- Radio Buttons -->
                        <div class="radio-group">
                            {% for option in field.options %}
                            <div class="form-check">
                                <input class="form-check-input" 
                                    type="radio" 
                                    name="{{ field.name }}" 
                                    id="{{ field.name }}_{{ option.value }}" 
                                    value="{{ option.value }}"
                                    {% if option.value == field.default %}checked{% endif %}>
                                <label class="form-check-label" for="{{ field.name }}_{{ option.value }}">
                                    {{ option.label }}
                                </label>
                            </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                {% endfor %}
                
                <button type="submit" class="btn btn-primary col-12">Prédire</button>
                
                {% if user.is_authenticated %}
                <a class="btn btn-outline-secondary col-12 mt-2" href="{% url 'model_predictions_list' config.name %}">
                    Voir mon historique pour ce modèle
                </a>
                {% endif %}
            </form>
        </div>
    </div>
</div>
{% endblock content %}